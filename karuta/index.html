<!DOCTYPE html>
<html lang="ja">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>萌神サンプル</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style type="text/css">
    body {
      font-family: "メイリオ",Meiryo,"ヒラギノ角ゴ Pro","Hiragino Kaku Gothic",sans-serif;
    }
    h1 {
      text-align: center;
    }
    .hidden {
      visibility: hidden;
    }
    p#hanziID {
      font-size: 60px;
      margin: 10px;
    }
    div.img {
      border: 5px dashed red;
    }
    img {
      width: 30%;
    }
    span#hanzi {
      font-size: 65px;
      font-weight: bold;
    }
    .text-center {
      text-align: center;
    }
    input {
      background: #333333;
      padding: 10px;
      min-width: 200px;
      font-size: 16pt;
       border-radius: 10px;        /* CSS3草案 */  
    -webkit-border-radius: 10px;    /* Safari,Google Chrome用 */  
    -moz-border-radius: 10px;   /* Firefox用 */  
    color: #ffffff;

    }
    div.omikujibase {
      background-image: url("docplate.jpg");
      background-repeat: no-repeat;
      background-position: top left;

      line-height: 1.2;
      margin: 0px; padding: 0px;
    }
    div.omikujibase p.kRes {
      margin: 0px;
      font-size: 40pt;
      line-height: 1.2;
    }
    div.omikujibase p.kCom {
      margin: 0px;
      font-size: 16pt;
      line-height: 1.2;
    }
    p.button {
      text-align: center;
      margin: 10px 0px;

    }

    /* 外枠：この装飾は無くても構いません */
    div.playground {
      margin: 1em 0px;
      padding: 1em;
      border: 1px solid gray;
    }

  </style>
  <script type="text/javascript">

    // ========================================
    // 効果音を鳴らす（★今回のメインはこれ★）
    // ========================================
    var array = [];
    var now = 0;

    var hanziMap = new Map([
          ["1", "../images/r01.png"],
          ["5", "../images/r02.png"],
          ["9", "../images/r03.png"],
          ["13", "../images/r04.png"],
          ["17", "../images/r05.png"],
          ["21", "../images/r06.png"],
          ["25", "../images/r07.png"],
          ["29", "../images/r08.png"],
          ["33", "../images/r09.png"],
          ["37", "../images/r10.png"],
          ["41", "../images/r11.png"],
          ["45", "../images/r12.png"],
          ["2", "../images/b01.png"],
          ["6", "../images/b02.png"],
          ["10", "../images/b03.png"],
          ["14", "../images/b04.png"],
          ["18", "../images/b05.png"],
          ["22", "../images/b06.png"],
          ["26", "../images/b07.png"],
          ["30", "../images/b08.png"],
          ["34", "../images/b09.png"],
          ["38", "../images/b10.png"],
          ["42", "../images/b11.png"],
          ["46", "../images/b12.png"],
          ["3", "../images/y01.png"],
          ["7", "../images/y02.png"],
          ["11", "../images/y03.png"],
          ["15", "../images/y04.png"],
          ["19", "../images/y05.png"],
          ["23", "../images/y06.png"],
          ["27", "../images/y07.png"],
          ["31", "../images/y08.png"],
          ["35", "../images/y09.png"],
          ["39", "../images/y10.png"],
          ["43", "../images/y11.png"],
          ["47", "../images/y12.png"],
          ["4", "../images/g01.png"],
          ["8", "../images/g02.png"],
          ["12", "../images/g03.png"],
          ["16", "../images/g04.png"],
          ["20", "../images/g05.png"],
          ["24", "../images/g06.png"],
          ["28", "../images/g07.png"],
          ["32", "../images/g08.png"],
          ["36", "../images/g09.png"],
          ["40", "../images/g10.png"],
          ["44", "../images/g11.png"],
          ["48", "../images/g12.png"],
          ['右', null],
          ['果', null],
          ['喜', null],
          ['机', null],
          ['欠', null],
          ['差', null],
          ['徐', null],
          ['除', null],
          ['西', null],
          ['千', null],
          ['浅', null],
          ['楚', null],
          ['端', null],
          ['断', null],
          ['刀', null],
          ['薄', null],
          ['宝', null],
          ['埋', null],
          ['油', null],
          ['几', null],
          ['拿', null],
          ['插', null],
          ['烟', null],
          ['习', null],
          ['优', null],
          ['卖', null],
          ['厌', null],
          ['处', null],
          ['岛', null],
          ['报', null],
          ['检', null],
          ['续', null],
          ['记', null],
          ['许', null],
          ['过', null],
          ['锅', null],
          ['间', null],
          ['颜', null],
        ]);

    Array.prototype.shuffle = function(){
      var i = this.length;
      while(i){
        var j = Math.floor(Math.random() * i);
        var t = this[--i];
        this[i] = this[j];
        this[j] = t;
      }
      return this;
    }

    function init() {
      for (i=0;i<hanziMap.size;i++){
        array[i] = i;
      }
      console.log(array.shuffle());
      readyHanzi(0);
    }
    function next() {
      now += 1;
      readyHanzi(now);
      console.log(array[now])
    }
    function readyHanzi(pos) {
      var img = document.getElementById("image");
      var span = img.nextElementSibling;
      var audio = document.getElementById("sound");
      var keyIdx = array[pos] + 1;
      document.getElementById("hanziID").innerText = keyIdx;
      if (keyIdx <= 48) {
        var imagePath = hanziMap.get(String(keyIdx));
        img.src = "" + imagePath;
        span.innerText = '';
        audio.src = "../" + keyIdx + ".mp3"
      } else {
        var hanzi = Array.from(hanziMap.keys())[keyIdx - 1];
        img.src = "";
        span.innerText = hanzi;
        audio.src = "../sound/" + keyIdx + ".mp3"
      }
      img.classList.add('hidden');
      span.classList.add('hidden');
      document.getElementById("OmikujiSound").load()
    }
    function ring() {
      document.getElementById("OmikujiSound").play();
      setTimeout(function(){
        document.getElementById("OmikujiSound").load();
      }, 1000);
      console.log(array[now])
    }
    function answer() {
      var img = document.getElementById("image");
      var span = img.nextElementSibling;
      img.classList.remove('hidden');
      span.classList.remove('hidden');
    }
  </script>
</head>
<body onLoad="init();">

  <h1>萌神歌牌</h1>
  <p>このサンプルは、<strong>音が鳴ります</strong>ので注意して下さい。<br>音声が出ない場合は、デバイスの音声をONにしてください。</p>

  <!-- =========================== -->
  <!-- ▼効果音を準備するaudio要素 -->
  <!-- =========================== -->

  <audio id="OmikujiSound" preload="auto">
    <source id="sound" src="" type="audio/mp3">
    <p>※お使いのブラウザは、残念ながらHTML5のaudio要素をサポートしていないようですから、音は鳴りません。</p>
  </audio>

  <div class="playground">
    <div class="omikujibase text-center">
      <p id="hanziID"></p>
      <div class="img">
        <img id="image" class="card" src="">
        <span id="hanzi"></span>
      </div>
    </div>

    <!-- ―――――――― -->
    <!-- ▼再生ボタン -->
    <!-- ―――――――― -->

    <p class="button">
      <input type="button" onclick="next();" value="下一个" />
    </p>
    <p class="button">
      <input type="button" onclick="ring();" value="放音" />
    </p>
    <p class="button">
      <input type="button" onclick="answer();" value="正确答案" />
    </p>
  </div>

</body>
</html>
